version: '3.9'
services:
  tests:
    build: .
    # Increase shared memory for Chromium stability (equivalent to --shm-size)
    shm_size: 1gb
    # Use host IPC to avoid Chrome crashes in Docker
    ipc: host
    # Run container processes as the host user to avoid root-owned files on bind mounts
    user: "${UID:-1000}:${GID:-1000}"
    environment:
      # Optional: base URL consumed in playwright.config.ts if your tests use it
      # Set your own value or remove
      - ENV=https://bonigarcia.dev/selenium-webdriver-java
      - CI=1
      # Reduce workers in container unless overridden
      - PW_WORKERS=1
    volumes:
      # Persist reports to host for inspection
      - ./playwright-report:/app/playwright-report
      - ./test-results:/app/test-results
    # Default command can be overridden via `docker compose run tests ...`
    command: npx playwright test
